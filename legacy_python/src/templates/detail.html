<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë©≥Á¥∞: {{ article.topic }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .img-preview {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .markdown-body {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
    </style>
</head>

<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">Recipe Pocket AI Manager</a>
            <a href="/" class="btn btn-outline-light btn-sm">‰∏ÄË¶ß„Å´Êàª„Çã</a>
        </div>
    </nav>

    <div class="container mt-4 mb-5">
        <div class="row">
            <div class="col-md-8">
                <!-- Tab Navigation -->
                <ul class="nav nav-tabs mb-3" id="articleTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="content-tab" data-bs-toggle="tab" data-bs-target="#content"
                            type="button" role="tab" aria-controls="content" aria-selected="true">Ë®ò‰∫ãÊú¨Êñá</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="analysis-tab" data-bs-toggle="tab" data-bs-target="#analysis"
                            type="button" role="tab" aria-controls="analysis" aria-selected="false">üìä ÂàÜÊûê„É¨„Éù„Éº„Éà</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="strategy-tab" data-bs-toggle="tab" data-bs-target="#strategy"
                            type="button" role="tab" aria-controls="strategy" aria-selected="false">üéØ Êà¶Áï•Á≠ñÂÆö</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="review-tab" data-bs-toggle="tab" data-bs-target="#review"
                            type="button" role="tab" aria-controls="review" aria-selected="false">üëÄ „É¨„Éì„É•„ÉºË©≥Á¥∞</button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="articleTabsContent">
                    <!-- Tab 1: Content -->
                    <div class="tab-pane fade show active" id="content" role="tabpanel" aria-labelledby="content-tab">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-white">
                                <h4 class="mb-0">
                                    {% if article.marketing_strategy is mapping %}
                                    {{ article.marketing_strategy.get('title', 'No Title') }}
                                    {% else %}
                                    {{ article.get('marketing_strategy', '').replace("'", '"') | default('No Title',
                                    true) }}
                                    {% endif %}
                                </h4>
                            </div>
                            <div class="card-body">
                                <div class="markdown-body">
                                    <pre style="white-space: pre-wrap;">{{ article.content }}</pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 2: Analysis Report -->
                    <div class="tab-pane fade" id="analysis" role="tabpanel" aria-labelledby="analysis-tab">
                        <div class="card shadow-sm mb-4">
                            <div class="card-body">
                                <h5>ÂàÜÊûê„Ç®„Éº„Ç∏„Çß„É≥„Éà (Analyst)</h5>
                                <hr>
                                {% if article.analysis_report %}
                                <dl class="row">
                                    <dt class="col-sm-3">ÊñπÂêëÊÄß</dt>
                                    <dd class="col-sm-9">{{ article.analysis_report.get('direction') }}</dd>

                                    <dt class="col-sm-3">ÈÅ∏ÂÆö„Éà„Éî„ÉÉ„ÇØ</dt>
                                    <dd class="col-sm-9"><strong>{{ article.analysis_report.get('topic') }}</strong>
                                    </dd>
                                </dl>
                                <details>
                                    <summary class="btn btn-sm btn-outline-secondary mb-2">Áîü„Éá„Éº„Çø„ÇíË°®Á§∫ (JSON)</summary>
                                    <pre
                                        class="bg-light p-3 border rounded">{{ article.analysis_report | tojson(indent=2) }}</pre>
                                </details>
                                {% else %}
                                <p class="text-muted">Ë©≥Á¥∞„Å™ÂàÜÊûê„É¨„Éù„Éº„Éà„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Tab 3: Marketing Strategy -->
                    <div class="tab-pane fade" id="strategy" role="tabpanel" aria-labelledby="strategy-tab">
                        <div class="card shadow-sm mb-4">
                            <div class="card-body">
                                <h5>„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞„Ç®„Éº„Ç∏„Çß„É≥„Éà (Marketer)</h5>
                                <hr>
                                {% if article.marketing_strategy is mapping %}
                                <dl class="row">
                                    <dt class="col-sm-3">„Çø„Éº„Ç≤„ÉÉ„Éà</dt>
                                    <dd class="col-sm-9">{{ article.marketing_strategy.get('target_audience') }}</dd>

                                    <dt class="col-sm-3">SEO„Ç≠„Éº„ÉØ„Éº„Éâ</dt>
                                    <dd class="col-sm-9">{{ article.marketing_strategy.get('seo_keywords') | join(', ')
                                        }}</dd>

                                    <dt class="col-sm-3">Ë®ò‰∫ã„ÅÆ„Å≠„Çâ„ÅÑ</dt>
                                    <dd class="col-sm-9">{{ article.marketing_strategy.get('goal') }}</dd>
                                </dl>
                                <details>
                                    <summary class="btn btn-sm btn-outline-secondary mb-2">Áîü„Éá„Éº„Çø„ÇíË°®Á§∫ (JSON)</summary>
                                    <pre
                                        class="bg-light p-3 border rounded">{{ article.marketing_strategy | tojson(indent=2) }}</pre>
                                </details>
                                {% else %}
                                <p>„É¨„Ç¨„Ç∑„Éº„Éá„Éº„ÇøÂΩ¢ÂºèÔºà„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„ÅøÔºâ:</p>
                                <pre class="bg-light p-3 border rounded">{{ article.marketing_strategy }}</pre>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Tab 4: Review Report -->
                    <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
                        <div class="card shadow-sm mb-4">
                            <div class="card-body">
                                <h5>ÂìÅË≥™ÁÆ°ÁêÜ„Ç®„Éº„Ç∏„Çß„É≥„Éà (Controller)</h5>
                                <hr>
                                {% if article.review_report %}
                                <div
                                    class="alert {{ 'alert-success' if article.review_report.get('status') == 'APPROVED' else 'alert-warning' }}">
                                    Âà§ÂÆö: <strong>{{ article.review_report.get('status') }}</strong> (Score: {{
                                    article.review_report.get('score') }}/100)
                                </div>
                                <p><strong>Á∑èÂêà„Ç≥„É°„É≥„Éà:</strong><br>{{ article.review_report.get('comments') }}</p>

                                <h6>Ë©≥Á¥∞Ë©ï‰æ°:</h6>
                                <ul>
                                    {% for item in article.review_report.get('details', []) %}
                                    <li>{{ item }}</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p>„Çπ„Ç≥„Ç¢: {{ article.review_score }}</p>
                                <p>„Ç≥„É°„É≥„Éà: {{ article.review_comment }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">„Çπ„ÉÜ„Éº„Çø„ÇπÁÆ°ÁêÜ</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-secondary">
                            ÁèæÁä∂: <strong>{{ article.status }}</strong>
                        </div>
                        <p>„Çπ„Ç≥„Ç¢: {{ article.review_score }}</p>
                        <p class="text-danger">{{ article.review_comment }}</p>

                        <hr>

                        {% if article.status == 'posted' %}
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle"></i> SupabaseÊäïÁ®øÊ∏à„Åø
                        </div>
                        {% else %}
                        <form action="/articles/{{ article.id }}/post_supabase" method="post" class="mb-3"
                            onsubmit="return confirm('Supabase„Å∏ÊäïÁ®ø„Åó„Åæ„Åô„ÅãÔºü');">
                            <button type="submit" class="btn btn-primary w-100">
                                üöÄ Supabase„Å∏ÊäïÁ®ø (Post)
                            </button>
                        </form>
                        {% endif %}

                        <form action="/articles/{{ article.id }}/update_status" method="post" class="d-grid gap-2">
                            <button type="submit" name="status" value="approved" class="btn btn-success">
                                ‚úÖ ÊâøË™ç (Approve Only)
                            </button>
                            <button type="submit" name="status" value="review_required" class="btn btn-warning">
                                ‚ö†Ô∏è ‰øùÁïô (Request Review)
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">ÁîüÊàêÁîªÂÉè</h5>
                    </div>
                    <div class="card-body">
                        {% for url in article.image_urls %}
                        <div class="mb-3">
                            <img src="{{ url }}" class="img-preview" alt="Generated Image {{ loop.index }}">
                            <small class="text-muted d-block text-truncate">{{ url }}</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>